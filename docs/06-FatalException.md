# Fatal Exception

Аспект "Фатальная ошибка" реализован в виде свойства `isFatal`, а так же публичного метода: `isFatal()`. 
Интересно заметить, что по сравнению с флагом `isLoggable()` 
у флага `isFatal` нет возможности сброса (разве что изнутри класса).

Так как `isFatal` - это свойство, то фатальным может стать любое исключение в любой момент времени:

```php
    try
    {
        ...
    }
    catch(BaseException $e)
    {
        throw $e->markAsFatal();
    }
```

Можно так же использовать исключение-контейнер, чтобы наделить этой характеристикой другое исключение:

```php
    try
    {
        ...
    }
    catch(BaseException $e)
    {
        // Теперь исключение $e - имеет аспект фатального.
        throw new FatalException($e);
    }
```

## Обработчик фатальных исключений

`Registry` предоставляет метод `Registry::setFatalHandler($callback)` для обработки появления фатальных исключений.

Прототип обработчика:

```php
    function(BaseExceptionI $exception)
    {
        // Если это контейнер - используем его содержимое
        if($exception->isContainer())
        {
            $real_exception = $exception->getPrevious();
        }
        else
        {
            $real_exception = $exception;
        }
        ...
    }
```

Обработчик фатальных исключений вызывается в момент, когда исключение становится фатальным, то есть:

1. В конце конструктора исключения `BaseException`.
2. В момент вызова метода `setFatal()`.

Обработчик фатального исключения вызывается не для журналирования. 
Он нужен для введения особого специального алгоритма, в условиях возможной нехватки ресурсов. 
Возможные задачи обработчика таковы:

- остановить программу или сервис;
- предотвратить повторные запуски work-еров, пока проблема не решиться;
- запустить процесс анализа сбоя.

## Особенности обработки для журнализатора

Журнализатор так же может обрабатывать фатальное исключение не так, как обычно:

1. Проверить возможность записи на диск или в файл журнала.
2. Если файл журнала не доступен, попытаться использовать системный журнал.
3. Использовать EMAIL для отправки уведомления.
4. Если EMAIL не работает, использовать альтернативные каналы.
